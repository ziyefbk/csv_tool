# 当前可优化项

## 🚀 高优先级优化（立即实施）

### 1. 前端性能优化 ⭐⭐⭐

#### 1.1 缓存唯一值计算
**问题**：`getColumnUniqueValues` 在每次渲染时都会重新计算
**影响**：打开筛选菜单时会有延迟，特别是大数据集
**解决**：使用 `useMemo` 缓存每个列的唯一值

```typescript
// 当前实现（性能问题）
const uniqueValues = getColumnUniqueValues(idx); // 每次渲染都计算

// 优化后
const uniqueValuesMap = useMemo(() => {
  const map = new Map<number, string[]>();
  headers.forEach((_, colIdx) => {
    map.set(colIdx, getColumnUniqueValues(colIdx));
  });
  return map;
}, [rows, headers]);
```

**预期效果**：筛选菜单打开速度提升 **10-100x**（取决于数据量）

#### 1.2 优化全局搜索筛选
**问题**：`filteredRows` 在 App.tsx 中每次渲染都重新计算
**解决**：使用 `useMemo` 缓存

```typescript
const filteredRows = useMemo(() => {
  if (!searchQuery) return pageData?.rows || [];
  const query = searchQuery.toLowerCase();
  return (pageData?.rows || []).filter((row) => 
    row.fields.some((field) => field.toLowerCase().includes(query))
  );
}, [pageData?.rows, searchQuery]);
```

**预期效果**：避免不必要的重新计算，性能提升 **2-5x**

#### 1.3 搜索防抖（Debounce）
**问题**：用户输入时立即触发搜索，导致频繁计算
**解决**：添加防抖，延迟 300ms 执行搜索

**预期效果**：减少不必要的计算，提升响应速度

### 2. 筛选功能增强 ⭐⭐

#### 2.1 筛选下拉菜单虚拟滚动
**问题**：如果列的唯一值很多（>100），下拉菜单性能差
**解决**：使用虚拟滚动显示唯一值

**预期效果**：支持数千个唯一值，性能流畅

#### 2.2 筛选搜索/过滤
**问题**：唯一值太多时，难以找到目标值
**解决**：在下拉菜单中添加搜索框，实时过滤选项

**预期效果**：快速找到目标值，提升用户体验

#### 2.3 多选筛选（可选）
**问题**：当前只支持单选筛选
**解决**：支持多选，使用复选框

**预期效果**：更灵活的筛选能力

---

## ⚡ 中优先级优化

### 3. 排序性能优化 ⭐

#### 3.1 大数据集排序优化
**问题**：当前排序在浏览器主线程执行，会阻塞 UI
**解决**：使用 Web Worker 进行排序

**预期效果**：大文件排序时 UI 不卡顿

---

## 🎨 用户体验优化

### 4. 列统计信息 ⭐⭐

**功能**：显示每列的统计信息
- 数据类型（数字/文本/日期）
- 非空值数量
- 唯一值数量
- 数值列：最小值、最大值、平均值、中位数
- 文本列：最短、最长、平均长度

**实现位置**：在 FileInfo 组件中显示，或者鼠标悬停表头时显示

### 5. 导出功能 ⭐⭐

**功能**：
- 导出当前视图（筛选/排序后的数据）
- 支持格式：CSV, JSON, Excel
- 可以只导出可见列

### 6. 键盘快捷键 ⭐

**功能**：
- `Ctrl+F` / `Cmd+F`: 聚焦搜索框
- `Ctrl+S` / `Cmd+S`: 导出
- 方向键：导航表格
- `Esc`: 关闭筛选菜单

---

## 📊 后端性能优化

### 7. 搜索性能优化 ⭐

**当前状态**：逐行扫描
**优化方向**：
- 使用 SIMD 加速（`memchr::memmem`）
- 构建搜索索引（倒排索引）
- 并行搜索（使用 `rayon`）

**预期效果**：搜索速度提升 **5-10x**

### 8. 排序性能优化 ⭐

**当前状态**：前端排序
**优化方向**：
- 后端并行排序（使用 `rayon`）
- 外部排序（超大文件）
- 流式排序（只排序前 N 行）

**预期效果**：排序速度提升 **3-5x**

---

## 🔧 代码质量优化

### 9. 错误处理增强

**改进**：
- 更好的错误提示
- 错误恢复机制
- 用户友好的错误消息

### 10. 测试覆盖

**改进**：
- 添加前端组件测试
- 添加集成测试
- 性能基准测试

---

## 📈 优化优先级总结

| 优先级 | 优化项 | 影响 | 难度 | 时间 |
|--------|--------|------|------|------|
| 🔥 高 | 缓存唯一值计算 | 大 | 低 | 1h |
| 🔥 高 | 优化全局搜索筛选 | 中 | 低 | 30min |
| 🔥 高 | 搜索防抖 | 中 | 低 | 30min |
| ⚡ 中 | 筛选下拉菜单优化 | 中 | 中 | 2-3h |
| ⚡ 中 | 列统计信息 | 大 | 中 | 3-4h |
| ⚡ 中 | 导出功能 | 大 | 中 | 4-5h |
| 💡 低 | 键盘快捷键 | 小 | 低 | 1-2h |
| 💡 低 | 后端搜索优化 | 大 | 高 | 1-2天 |
| 💡 低 | 后端排序优化 | 中 | 高 | 1-2天 |

---

**最后更新**: 2025-12-27

